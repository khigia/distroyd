            <!-- <div id="timing"></div> -->
            <!--
            <button class='first last' onclick='update(generateDataset())'> 
              Update
            </button>
            -->
            <div id="viztab"></div>
            <div id="log"></div>
            <script type="text/javascript">

              var conn;
              var log = $("#log");

              var t = d3.select("#viztab")
                .append("table")
                .style("border-collapse", "collapse")
                .style("border", "2px black solid");

                
              function generateDataset() {
                  var dataset = [],
                      i, j;
                  //var h = 10 + Math.round(5 * Math.random());
                  //if(h % 2) { h++; }
                  var h = 12;
              
                  for (i = 0; i < h / 2; i++) {
                    dataset.push([0, 1500 - i * 10, Math.round(100 * Math.random())]);
                  }
                  for (i = h / 2; i < h; i++) {
                    dataset.push([Math.round(100 * Math.random()), 1500 - i * 10, 0]);
                  }
                  return dataset;
              }

              var coln = 1;

              function update(dataset) {
                /*
                var time1 = new Date().getTime();
                */
                var tt = t.selectAll("tr")
                  .data(dataset);
                tt.selectAll("td")
                 .data(function(d){return d;})
                 .text(function(d){if(d > 0) { return d; } else {return "";}});
                tt.exit().remove();
                tt.enter().append("tr")
                 .on("mousedown", function(d, i){
                    // appendLog($("<div/>").text(JSON.stringify(d)));
                    if (conn) {
                      conn.send(JSON.stringify({
                            'Login':'{{.Login}}',
                            'Inst':'{{.Instrument}}',
                            'Row':d,
                            'Coln':coln}));
                    }
                  })
                 .selectAll("td")
                 .data(function(d){return d;})
                 .enter().append("td")
                 .style("border", "1px black solid")
                 .style("padding", "10px")
                 .on("mouseout", function(){d3.select(this).style("background-color", "white")}) 
                 .on("mousedown", function(d, i){
                         d3.select(this).style("background-color", "skyblue");
                         //appendLog($("<div/>").text(JSON.stringify(d)));
                         //appendLog($("<div/>").text(JSON.stringify(i)));
                         coln = i;
                  })
                 .on("mouseup", function(){d3.select(this).style("background-color", "aliceblue")})
                 .text(function(d){if(d > 0) { return d; } else {return "";}})
                 .style("font-size", "12px");
                
                /*
                var time2 = new Date().getTime();
                var time = time2 - time1;
                d3.select("#timing").selectAll("p").data([time]).enter().append("p").text(function(d){return d;});
                */
              }
              // update(generateDataset());

              function appendLog(msg) {
                  var d = log[0]
                  var doScroll = d.scrollTop == d.scrollHeight - d.clientHeight;
                  msg.appendTo(log)
                  if (doScroll) {
                      d.scrollTop = d.scrollHeight - d.clientHeight;
                  }
              }

              if (window["WebSocket"]) {
                  var conn = new WebSocket("ws://localhost:8080/ws/dashboard/{{.Instrument}}");
                  conn.onclose = function(evt) {
                      appendLog($("<div><b>Connection closed.</b></div>"))
                  }
                  conn.onmessage = function(evt) {
                      var obj = jQuery.parseJSON(evt.data);
                      if (obj.Tag == "md") {
                        update(obj.Dt);
                      } else {
                        appendLog($("<div/>").text(JSON.stringify(obj)))
                      }
                  }
              } else {
                  appendLog($("<div><b>Your browser does not support WebSockets.</b></div>"))
              }

            </script>
          </div>

